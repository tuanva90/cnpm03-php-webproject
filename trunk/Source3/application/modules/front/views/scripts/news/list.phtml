<div id="content">
  <div class="breadcrumb"></div>
  <pre>
  </pre>
  <?php if(isset($_SESSION['EditMode'])) if($_SESSION['EditMode'] == 'ON'){?>
  <script>
  $(document).ready(function(){
		var _currentNewsID;

		/*
		$(document).mousemove(function(e){
			_mouseX = e.pageX;
			_mouseY = e.pageY;
			});
		*/
		//
		$('#contextMenu').hide();
		$('.a-news').addClass('editable');
		
		$('.editable').mouseenter(function(e){
			if($('#contextMenu').css('display')=='block') return false;
			
			e.stopPropagation();
			
			_currentNewsID = $(this).attr('news_id');
			
			var offset = $(this).position();
			$('#highlighter-region').css('position','absolute');
			$('#highlighter-region').css('top', offset.top);
			$('#highlighter-region').css('left', offset.left);
			$('#highlighter-region').css('width',$(this).outerWidth());//outerWidth(option)/outerHeight(option): get width/height include border and padding by default of the first matched element
			$('#highlighter-region').css('height',$(this).outerHeight());
			$('#highlighter-region').css('display','block');
			
		});
		
		$('#highlighter-region').click(function(e){
			e.stopPropagation();
			
			// fuu, $(this).offset() lay offset top voi document, this.offsetTop lay offset top voi parent element
			// damn u
			var posy = e.pageY - $(this).offset().top + this.offsetTop;
			var posx = e.pageX - $(this).offset().left;
			
			$('#contextMenu').css('top',posy);
			$('#contextMenu').css('left',posx);
			$('#contextMenu').find('input[name=news-id]').val(_currentNewsID);
			$('#contextMenu').show();
			
		});

		$('#remove-menu-item_01').bind('click',function(){
				$.ajax({
					type:'POST',
					url:'<?php echo $this->baseUrl('front/services/getnewstitle')?>',
					data:{news_id:_currentNewsID},
					dataType:'json',
					success:function(json){
						if(json.success){
							$('#remove-news-form').find('#removed-news-title').html(json.news_title);
							$('#remove-news-form input[name=news_id]').val(_currentNewsID);
						}
						else if(json.error){
							alert(json.error);
						}
					}
				});
				
				$('#remove-form').dialog("open");
			});

		
		$('#edit-menu-item_01').bind('click',function(){
			$.ajax({
				type:'POST',
				url:'<?php echo $this->baseUrl('front/services/getnews')?>',
				data:{news_id:_currentNewsID},
				dataType:'json',
				success:function(json){
					if(json.success){
						$('#edit-news-form input[name=save-news-id]').val(json.news_id);
						$('#edit-news-form img[name=image]').attr('src',json.image);
						$('#edit-news-form input[name=sort-order]').val(json.sort_order);
						$('#edit-news-form select[name=status]').val(json.status);
						if(json.en_language)
						{
							$('#edit-news-form fieldset input[name=en_title]').val(json.en_title);
							$('#edit-news-form fieldset textarea[name=en_summary]').val(json.en_summary);
							$('#edit-news-form fieldset textarea[name=en_description]').val(json.en_description);
							$('#edit-news-form fieldset input[name=en_metakeywords]').val(json.en_meta_keywords);
							$('#edit-news-form fieldset input[name=en_metadescription]').val(json.en_meta_description);
						}
						if(json.vi_language)
						{
							$('#edit-news-form fieldset input[name=vi_title]').val(json.vi_title);
							$('#edit-news-form fieldset textarea[name=vi_summary]').val(json.vi_summary);
							$('#edit-news-form fieldset textarea[name=vi_description]').val(json.vi_description);
							$('#edit-news-form fieldset input[name=vi_metakeywords]').val(json.vi_meta_keywords);
							$('#edit-news-form fieldset input[name=vi_metadescription]').val(json.vi_meta_description);
						}
					}
					if(json.error){
						alert(json.error);
					}
				}
			});
			

			$('#edit-form').dialog("open");
		});

		
		$('#add-menu-item_01').click(function(){
			$('#add-form').dialog("open");
		});

		$('#detail-menu-item_01').bind('click',function(){
			$('#showdetails-frm').find('input[name=news_id]').val(_currentNewsID);
			$('#showdetails-frm').submit();
			});
	});
	$(function(){
		//
		$(document).click(function(e){
			$('#highlighter-region').hide();
			$('#contextMenu').hide();
		});
		
		//
		$('#add-form').dialog({
				autoOpen:false,
				modal:true,
				width:500,
				height:500,
				buttons: {
					"Save": function() {
						$('#add-news-form').submit();
					},
					Cancel: function() {
						$( this ).dialog( "close" );
					}
				}
		});
		
		//
		$('#edit-form').dialog({
			autoOpen:false,
			modal:true,
			width:500,
			height:500,
			buttons:{
				"Save":function(){
					$('#edit-news-form').submit();
				},
				Cancel:function(){
					$(this).dialog("close");
				}
			}
		});

		$('#remove-form').dialog({
			autoOpen:false,
			modal:true,
			width:300,
			height:300,
			buttons:{
				Xóa:function(){
					$('#remove-news-form').submit();
				},
				"Hủy bỏ":function(){
					$(this).dialog("close");
				}
			}
		});
	});
  </script>
  
  <div id="highlighter-region">
  </div>
  
  <div id="contextMenu">
  	<form id='news-context-menu' name='contextMenu' method='post' action="">
  		<input type='hidden' name='news-id' value=''/>
  		<input type="hidden" id="delete-action" value="<?php echo $this->baseUrl('front/newnews/delete');?>">
  		<ul id="contextMenu_01">
  			<li><a href="javascript:void();"><span class="add-menu-item" id="add-menu-item_01">Add</span></a></li>
  			<li><a href="javascript:void();"><span class="edit-menu-item" id="edit-menu-item_01">Edit</span></a></li>
  			<li><a href="javascript:void();"><span class="remove-menu-item" id="remove-menu-item_01">Remove</span></a></li>
  			<li><a href="javascript:void();"><span class="detail-menu-item" id="detail-menu-item_01">Show detail</span></a></li>
  		</ul>
  	</form>
  </div>
  
  <div id="add-form" title="Khung thêm bài viết">
  <form id="add-news-form" name="add-news-form" method="post" action="<?php echo $this->baseUrl($this->currentController.'/add')?>">
  	<fieldset>
 	<legend>ThÃ´ng tin chung</legend>
 	<span style="width:100px; display:inline-block">Image</span><input type="text" name="image" size="60"><br/>
 	<span style="width:100px; display:inline-block">Sort order</span><input type="text" name="sort-order" size="3"><br/>
 	<span style="width:100px; display:inline-block">Status</span><select name="status"><option value="1">Enable</option><option value="0">Disable</option></select><br/>
 	</fieldset>
 	
 	<fieldset>
 	<legend>PhiÃªn báº£n tiáº¿ng viá»‡t</legend>
 	Title<br/><input type="text" name="vi_title" size="83"><br/>
 	Summary<br/><textarea cols="80" rows="2" name="vi_summary"></textarea><br/>
 	Description<br/><textarea cols="80" rows="6" name="vi_description"></textarea><br/>
 	Meta keywords<br/><input type="text" name="vi_metakeywords" size="60"><br/>
 	Meta description<br/><input type="text" name="vi_metadescription" size="60"><br/>
 	</fieldset>
 	
 	<fieldset>
 	<legend>PhiÃªn báº£n tiáº¿ng anh</legend>
 	Title<br/><input type="text" name="en_title" size="83"><br/>
 	Summary<br/><textarea cols="80" rows="2" name="en_summary"></textarea><br/>
 	Description<br/><textarea cols="80" rows="6" name="en_description"></textarea><br/>
 	Meta keywords<br/><input type="text" name="en_metakeywords" size="60"><br/>
 	Meta description<br/><input type="text" name="en_metadescription" size="60"><br/>
 	</fieldset>
 	
 	</form>
  </div>
  
  <div id="edit-form" title="Khung sửa bài viết">
  <form id="edit-news-form" name="edit-news-form" method="post" action="<?php echo $this->baseUrl($this->currentController.'/save')?>">
  	<input type="hidden" name="save-news-id" value=""/>
  	<fieldset>
 	<legend>ThÃ´ng tin chung</legend>
 	<span style="width:100px; display:inline-block">Image</span><img src="" name="image"><a href="javascript:void();" id="edit-news-change-image">Change</a><br/>
 	<span style="width:100px; display:inline-block">Sort order</span><input type="text" name="sort-order" size="3"><br/>
 	<span style="width:100px; display:inline-block">Status</span><select name="status"><option value="1">Enable</option><option value="0">Disable</option></select><br/>
 	</fieldset>
 	
 	<fieldset>
 	<legend>PhiÃªn báº£n tiáº¿ng viá»‡t</legend>
 	Title<br/><input type="text" name="vi_title" size="83"><br/>
 	Summary<br/><textarea cols="80" rows="2" name="vi_summary"></textarea><br/>
 	Description<br/><textarea cols="80" rows="6" name="vi_description"></textarea><br/>
 	Meta keywords<br/><input type="text" name="vi_metakeywords" size="60"><br/>
 	Meta description<br/><input type="text" name="vi_metadescription" size="60"><br/>
 	</fieldset>
 	
 	<fieldset>
 	<legend>PhiÃªn báº£n tiáº¿ng anh</legend>
 	Title<br/><input type="text" name="en_title" size="83"><br/>
 	Summary<br/><textarea cols="80" rows="2" name="en_summary"></textarea><br/>
 	Description<br/><textarea cols="80" rows="6" name="en_description"></textarea><br/>
 	Meta keywords<br/><input type="text" name="en_metakeywords" size="60"><br/>
 	Meta description<br/><input type="text" name="en_metadescription" size="60"><br/>
 	</fieldset>
 	
 	</form>
  </div>
  
  <div id="remove-form" title="Xóa bài viết">
  	<form id="remove-news-form" name="remove-news-form" method="post" action="<?php echo $this->baseUrl('front/newnews/delete');?>">
  		Bạn có muốn xóa bài viết
  		<h4 id="removed-news-title"></h4>
  		<input type='hidden' name='news_id' value=''/>
  	</form>
  </div>
  <div id="showdetails-form">
  	<form id="showdetails-frm" method="post" action="<?php echo $this->baseUrl('front/news/detail');?>">
  		<input type="hidden" name="news_id"/>
  	</form>
  </div>
  
  <?php }?>
  <div id="click-and-change-news-tool-bar ui-widget-header ui-corner-all">
  	<div id="btnTurnOnEditMode" role="button" class="state-changable-buttonstate-changable-button ui-button ui-widget ui-state-default ui-corner-all ui-button-text-only"><span class="ui-button-text"><a href="<?php echo $this->baseUrl($this->currentController.'/changeeditmode');?>">Turn Edit Mode On or Off</a></span></div>
  </div>
  <?php if ($this->Items) { ?>
  <div class="news-list">
    <?php foreach ($this->Items as $news) { ?>
    <div class="a-news" news_id="<?php echo $news['news_id'];?>">
      <?php if ($news['image']) { ?>
      <div class="image"><a class="fancybox" href="<?php echo $this->baseUrl($this->currentController . '/detail/news_id/' . $news['news_id']);?>" title="<?php echo $news['title']; ?>"><img src="<?php echo HTTP_IMAGES . '/' . $news['image']; ?>" width="90" height="90" title="<?php echo $news['title']; ?>" /></a></div>
      <?php } ?>
      <div class="title"><a href="<?php echo $this->baseUrl($this->currentController . '/detail/news_id/' . $news['news_id']);?>"><?php echo $news['title']; ?></a></div>
      <div class="summary"><?php echo html_entity_decode($news['summary'], ENT_QUOTES, 'UTF-8'); ?></div>
    </div>
    <?php } ?>
    <div class="pagination">
    <?php 
    	$currentUrl = $this->baseUrl($this->currentController . '/list/category_id/'.$this->arrParam['category_id']);
    	echo $this->paginationControl($this->panigator,'Sliding','pagination.phtml', array('currentUrl'=>$currentUrl));
    ?>
    </div>
  </div>
  <?php } ?>
</div>